<html>
  <body>
    <div><h2>SmellyBumRPG</h2></div>
    <h3>Golestandt</h3>
    <p>
      Golestandt: This monster has been increased in difficulty, will now have a
      chance to spawn more frequently and has been moved back inside his lair
      with adjustments made to address pathing issues while inside the lair.
      Additionally, Golestandt’s corpse will now decay within a half hour in
      order to allow players to forcibly spawn him once every half hour if
      Gerrik’s Sword is used. Also swallowed Trev's peepee
    </p>

    <table>
      <tr>
        <td>Health</td>
        <td><span id="health">0</span></td>
      </tr>
    </table>
    <h3>You</h3>
    <table>
      <tr>
        <td>Name</td>
        <td>
          <form id="player-name-form">
            <input
              type="text"
              name="player-name"
              id="player-name"
              value=""
            /><input
              type="submit"
              name="player-name-save"
              value="Save"
              id="player-name-save"
            />
          </form>
        </td>
      </tr>

      <tr>
        <td>Health</td>
        <td><span id="player-health">0</span></td>
      </tr>
      <tr>
        <td>XP</td>
        <td><span id="player-xp">0</span></td>
      </tr>
      <tr>
        <td>Level</td>
        <td><span id="player-level">0</span></td>
      </tr>
    </table>
    <div>
      <h3>Player List</h3>
      <ul id="player-list">
        <li>Loading...</li>
      </ul>
    </div>
    <div>
      <input type="button" name="attack" value="Attack" id="attack" />
    </div>
    <div style="margin-top: 10px;">
      <hr />
      <iframe
        width="400"
        height="200"
        src="https://www.youtube-nocookie.com/embed/IJiHDmyhE1A"
        frameborder="0"
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
      ></iframe>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();
    </script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script>
      $(function () {
        $("#player-name-form").submit(function (e) {
          e.preventDefault();
          console.log($("#player-name").val());
          socket.emit("player name save", $("#player-name").val());
        });
        $("#attack").click(function (e) {
          socket.emit("attack");
        });
      });
      socket.on("mob health update", function (health) {
        $("#health").text(health);
      });
      socket.on("player health update", function (playerHealth) {
        $("#player-health").text(playerHealth);
      });
      socket.on("player xp update", function (xp) {
        $("#player-xp").text(xp);
      });
      socket.on("player level update", function (playerLevel) {
        $("#player-level").text(playerLevel);
      });
      socket.on("player list update", function (playerList) {
        // update this player
        $("#player-health").text(playerList[socket.id]["health"]);
        $("#player-xp").text(playerList[socket.id]["xp"]);
        $("#player-level").text(playerList[socket.id]["level"]);

        // update the entire player list
        $("#player-list").empty();
        for (let key in playerList) {
          let str = "<li>";

          if (key == socket.id) {
            str += "<strong>";
          }

          str += `ID: ${key} | Name: ${playerList[key]["name"]} |  Health: ${playerList[key]["health"]} | Attack: ${playerList[key]["attack"]} | XP: ${playerList[key]["xp"]} | Level: ${playerList[key]["level"]}`;

          if (key == socket.id) {
            str += "</strong>";
          }

          str += "</li>";

          $("#player-list").append(str);
        }
      });
    </script>
  </body>
</html>
